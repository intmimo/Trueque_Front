<ion-header [translucent]="true">
  <ion-toolbar class="header-gradient-green">
    <ion-title class="header-title">Registro</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="registro-content">
  <div class="registro-container">
    <div class="form-wrapper">
      <!-- Título principal -->
      <div class="welcome-section">
        <h2 class="welcome-title">Crear cuenta</h2>
        <p class="welcome-subtitle">Nuestra app de trueque</p>
      </div>

      <!-- Formulario con tarjeta -->
      <div class="form-card">
        <form [formGroup]="registroForm" (ngSubmit)="registrarse()" class="registro-form">

          <!-- Foto de perfil -->
          <div class="form-group">
            <div class="photo-upload-section">
              <h3 class="section-title">
                <span class="title-indicator"></span>
                Foto de perfil (opcional)
              </h3>
              <div class="photo-container">
                <div class="photo-preview" (click)="triggerFileInput()">
                  <img *ngIf="fotoPreview; else noPhoto" [src]="fotoPreview" alt="Foto de perfil">
                  <ng-template #noPhoto>
                    <ion-icon name="camera-outline" class="camera-icon"></ion-icon>
                    <p class="photo-text">Toca para agregar foto</p>
                  </ng-template>
                </div>
                <input #fileInput type="file" (change)="onFileSelected($event)" accept="image/*" style="display: none;">
              </div>
            </div>
          </div>
          
          <!-- Campo Nombre -->
          <div class="form-group">
            <ion-item class="form-item" lines="none">
              <ion-label position="floating" class="form-label">Nombre</ion-label>
              <ion-input
                formControlName="nombre"
                class="form-input"
                placeholder="Tu nombre completo">
              </ion-input>
            </ion-item>
            @if (isFieldInvalid('nombre')) {
              <ion-note color="danger" class="error-message">
                El nombre es obligatorio.
              </ion-note>
            }
          </div>

          <!-- Campo Email -->
          <div class="form-group">
            <ion-item class="form-item" lines="none">
              <ion-label position="floating" class="form-label">Email</ion-label>
              <ion-input
                type="email"
                formControlName="email"
                class="form-input"
                placeholder="tu@email.com">
              </ion-input>
            </ion-item>
            @if (isFieldInvalid('email')) {
              <ion-note color="danger" class="error-message">
                Debes ingresar un correo válido.
              </ion-note>
            }
          </div>

          <!-- Campo Contraseña -->
          <div class="form-group">
            <ion-item class="form-item" lines="none">
              <ion-label position="floating" class="form-label">Contraseña</ion-label>
              <ion-input
                type="password"
                formControlName="password"
                class="form-input"
                placeholder="••••••••">
              </ion-input>
            </ion-item>
            @if (isFieldInvalid('password')) {
              <ion-note color="danger" class="error-message">
                La contraseña es obligatoria (mínimo 8 caracteres).
              </ion-note>
            }
          </div>

          <!-- Campo Confirmar contraseña -->
          <div class="form-group">
            <ion-item class="form-item" lines="none">
              <ion-label position="floating" class="form-label">Confirmar Contraseña</ion-label>
              <ion-input
                type="password"
                formControlName="confirmarPassword"
                class="form-input"
                placeholder="••••••••">
              </ion-input>
            </ion-item>
            @if (registroForm.touched && registroForm.errors?.['noCoinciden']) {
              <ion-note color="danger" class="error-message">
                Las contraseñas no coinciden.
              </ion-note>
            }
          </div>

          <!-- Sección de ubicación -->
          <div class="location-section">
            <h3 class="section-title">
              <span class="title-indicator"></span>
              Información de ubicación
            </h3>

            <!-- Campo Colonia -->
            <div class="form-group">
              <ion-item class="form-item" lines="none">
                <ion-label position="floating" class="form-label">Colonia</ion-label>
                <ion-input
                  formControlName="colonia"
                  class="form-input"
                  placeholder="Nombre de tu colonia">
                </ion-input>
              </ion-item>
              @if (isFieldInvalid('colonia')) {
                <ion-note color="danger" class="error-message">
                  La colonia es obligatoria.
                </ion-note>
              }
            </div>

            <!-- Campo Municipio -->
            <div class="form-group">
              <ion-item class="form-item" lines="none">
                <ion-label position="floating" class="form-label">Municipio</ion-label>
                <ion-input
                  formControlName="municipio"
                  class="form-input"
                  placeholder="Nombre de tu municipio">
                </ion-input>
              </ion-item>
              @if (isFieldInvalid('municipio')) {
                <ion-note color="danger" class="error-message">
                  El municipio es obligatorio.
                </ion-note>
              }
            </div>
          </div>

          <!-- Botón de registro -->
          <div class="button-group">
            <ion-button
              expand="full"
              type="submit"
              [disabled]="!registroForm.valid"
              class="registro-button">
              <span class="button-text">Registrarse</span>
            </ion-button>
          </div>

          <!-- Divisor -->
          <div class="divider">
            <div class="divider-line"></div>
            <span class="divider-text">o</span>
          </div>

          <!-- Botón de login -->
          <ion-button
            expand="full"
            fill="clear"
            (click)="irALogin()"
            class="login-button">
            <span class="login-text">¿Ya tienes cuenta? <span class="login-link">Inicia sesión</span></span>
          </ion-button>
        </form>
      </div>
    </div>
  </div>
</ion-content>

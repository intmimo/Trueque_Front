<ion-header>
  <ion-toolbar>
    <ion-title>Detalle del Producto</ion-title>
    <ion-buttons slot="start">
      <!-- Ajusta la ruta de retorno al tab de productos -->
      <ion-back-button defaultHref="/tabs/tab2"></ion-back-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

@if (product; as i) {
  <ion-content>

    @if (i.images?.length > 0) {
      <swiper-container slides-per-view="1" space-between="10" loop="true" pagination="true" class="carousel-slides">
        @for (img of i.images; track img) {
          <swiper-slide>
            <img [src]="img.image_url" alt="Imagen del producto" class="carousel-image" />
          </swiper-slide>
        }
      </swiper-container>
    }

    <ion-card class="product-card">
      <ion-card-content>
        <ion-card-title>
          {{ i.name }}
          <ion-button fill="clear" size="small" (click)="toggleLike()">
            <ion-icon [name]="isLiked ? 'heart' : 'heart-outline'" color="danger"></ion-icon>
            {{ likesCount }}
          </ion-button>
          <span [ngClass]="{ 'disponible': i.status === 'disponible', 'intercambiado': i.status === 'intercambiado' }">
            {{ i.status | titlecase }}
          </span>
        </ion-card-title>

        <ion-card-subtitle>{{ i.created_at | date:'dd MMM yyyy' }}</ion-card-subtitle>

        <p>{{ i.description }}</p>
        <p><strong>Intercambio por:</strong> {{ i.wanted_item }}</p>

        <ion-label>
          <h3><strong>Vendedor:</strong> {{ i.user?.name }}</h3>
          <p><strong>Ubicación:</strong> {{ i.user?.municipio || i.location }}, {{ i.user?.colonia }}</p>
        </ion-label>
      </ion-card-content>

      <!-- Si NO es tu producto -->
      @if (!isMyProduct) {
        <ion-button expand="block" class="button" (click)="chat()">
          <ion-icon name="chatbubbles-outline" slot="start"></ion-icon>
          Me interesa
        </ion-button>
      }

      <!-- Si SÍ es tu producto -->
      @if (isMyProduct) {
        <ion-button expand="block" color="warning" class="button" (click)="editProduct()">
          <ion-icon name="create-outline" slot="start"></ion-icon>
          Editar producto
        </ion-button>

        <ion-button expand="block" color="danger" class="button" (click)="deleteProduct()">
          <ion-icon name="trash-outline" slot="start"></ion-icon>
          Eliminar producto
        </ion-button>
      }

      <ion-button expand="block" class="button share-button" (click)="shareProduct()">
        <ion-icon name="share-social-outline" slot="start"></ion-icon>
        Compartir
      </ion-button>
    </ion-card>
  </ion-content>
}
